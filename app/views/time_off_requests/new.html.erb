<div class="row">
  <div class="col-lg-8 mx-auto">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">
          <i class="bi bi-plus-circle"></i> New Time-Off Request
        </h4>
      </div>
      <div class="card-body">
        <%= form_with model: @time_off_request, local: true do |f| %>
          <% if @time_off_request.errors.any? %>
            <div class="alert alert-danger">
              <h5 class="alert-heading">
                <i class="bi bi-exclamation-triangle"></i> 
                <%= pluralize(@time_off_request.errors.count, "error") %> prohibited this request from being saved:
              </h5>
              <ul class="mb-0">
                <% @time_off_request.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

        <div class="mb-3">
          <%= f.label :time_off_type, "Leave Type", class: "form-label" %>

          <%= f.select :time_off_type,
              TimeOffRequest.time_off_types.keys.map { |k| [k.humanize, k] },
              { prompt: "Select leave type" },
              { class: "form-select", required: true } %>

          <div class="form-text">Choose the type of leave you're requesting.</div>
        </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <%= f.label :start_date, class: "form-label" %>
              <%= f.date_field :start_date, 
                  class: "form-control", 
                  min: Date.current,
                  required: true %>
            </div>

            <div class="col-md-6 mb-3">
              <%= f.label :end_date, class: "form-label" %>
              <%= f.date_field :end_date, 
                  class: "form-control",
                  min: Date.current,
                  required: true %>
            </div>
          </div>

          <div class="mb-3">
            <%= f.label :reason, class: "form-label" %>
            <%= f.text_area :reason, 
                class: "form-control", 
                rows: 4,
                placeholder: "Briefly describe the reason for your time-off request..." %>
            <div class="form-text">Optional: Provide additional context for your request.</div>
          </div>

          <!-- Vacation Balance Info. Add subtraction balance. -->
          <div class="alert alert-info">
            <i class="bi bi-info-circle"></i>
            <strong>Your Vacation Balance:</strong>
            <%= current_user.remaining_vacation_days %> days remaining this year
          </div>

          <div class="d-flex justify-content-between">
            <%= link_to "Cancel", time_off_requests_path, class: "btn btn-outline-secondary" %>
            <%= f.submit "Submit Request", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Help Card -->
    <div class="card mt-3">
      <div class="card-body">
        <h6 class="card-title">
          <i class="bi bi-question-circle"></i> Need Help?
        </h6>
        <ul class="mb-0">
          <li>Time-off requests are calculated in business days (excluding weekends)</li>
          <li>Pending requests can be edited or cancelled</li>
          <li>You'll receive an email notification when your request is reviewed</li>
          <li>Contact your manager if you have questions about approval</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-calculate and show days when dates change
  document.addEventListener('DOMContentLoaded', function() {
    const startDate = document.querySelector('input[name="time_off_request[start_date]"]');
    const endDate = document.querySelector('input[name="time_off_request[end_date]"]');
    
    function calculateBusinessDays() {
      if (startDate.value && endDate.value) {
        const start = new Date(startDate.value);
        const end = new Date(endDate.value);
        
        if (end < start) {
          return;
        }
        
        let days = 0;
        const current = new Date(start);
        
        while (current <= end) {
          const dayOfWeek = current.getDay();
          if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Not Sunday or Saturday
            days++;
          }
          current.setDate(current.getDate() + 1);
        }
        
        // Show estimated days (optional enhancement)
        console.log('Estimated business days:', days);
      }
    }
    
    startDate?.addEventListener('change', calculateBusinessDays);
    endDate?.addEventListener('change', calculateBusinessDays);
  });
</script>
